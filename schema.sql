CREATE DATABASE  `yeticave`;
USE `yeticave`;

CREATE TABLE `lot` (
	`id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`dateLotCreate` DATE NULL DEFAULT NULL,
	`nameLot` CHAR(255) NULL DEFAULT NULL,
	`description` VARCHAR(2048) NULL,
	`image` CHAR(50) NULL DEFAULT NULL,
	`lotRate` INT(10) UNSIGNED NULL DEFAULT NULL,
	`dateLotEnd` DATE NULL DEFAULT NULL,
	`stepLotRate` INT(10) UNSIGNED NULL DEFAULT NULL,
	`favCount` INT(10) UNSIGNED NULL DEFAULT NULL,
	`author` INT(7) UNSIGNED NULL DEFAULT NULL,
	`winner` INT(7) UNSIGNED NULL DEFAULT NULL,
	`category` TINYINT(1) UNSIGNED NULL DEFAULT NULL
);

CREATE TABLE `category` (
	`id` TINYINT(1) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`category` CHAR(50) NOT NULL
);

CREATE TABLE `user` (
	`id` INT(7) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`date` DATE NOT NULL,
	`email` CHAR(128) NOT NULL,
	`name` CHAR(128) NOT NULL,
	`password` CHAR(128) NOT NULL,
	`avatar` CHAR(50) NOT NULL,
	`contacts` VARCHAR(512) NOT NULL
);

CREATE TABLE `bet` (
	`id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`date` INT(10) UNSIGNED NOT NULL,
	`price` INT(10) UNSIGNED NOT NULL,
	`lot` INT(10) UNSIGNED NOT NULL,
	`user` INT(7) UNSIGNED NOT NULL
);

ALTER TABLE `lot`
    ADD INDEX `nameLot` (`nameLot`),
    ADD CONSTRAINT `FK_lot_category` FOREIGN KEY (`category`) REFERENCES `category` (`id`),
    ADD CONSTRAINT `FK_lot_user` FOREIGN KEY (`author`) REFERENCES `user` (`id`),
    ADD CONSTRAINT `FK_lot_user_w` FOREIGN KEY (`winner`) REFERENCES `user` (`id`);

ALTER TABLE `bet` 
    ADD CONSTRAINT `FK_bet_lot` FOREIGN KEY	(`lot`) REFERENCES `lot` (`id`),
    ADD CONSTRAINT `FK_bet_user` FOREIGN KEY (`user`) REFERENCES `user` (`id`);

ALTER TABLE `user`
    ADD UNIQUE INDEX `email` (`email`);